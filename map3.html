<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
         <meta charset="utf-8">
         <title>D3 Test</title>
	 <script type="text/javascript" src="./lib/d3.js"></script>
	<script src="./lib/d3.js" charset="utf-8"></script>
        <script src="./lib/topojson.js" charsdet="utf-8"></script>
	<script src="./code.json" charsdet="utf-8"></script>
      </head>
      <body>
<script type="text/javascript">
console.log("hello1");
var width = 960;
var height = 500;
var svg = d3.select("body").append("svg").attr("width",width).attr("height",height);
var color = d3.scaleLinear().domain([4000,50000]).range([255,0]);

// console.log("hello2");
// var poptotalHash={};
// d3.csv("./pop_data20181024_23.csv").then(function(data){
// 	//total population variable
// 	//2018/10/24 23時だけ
// 	console.log("hello3");
// 	console.log(data.length);
// 	console.log(data.time);
// 	console.log(data[0]);
// 	if(data.time==23){
// 	poptotalHash[data.code]=data.pop_total;
// 	}
	
// });
// 	console.log("hello4");
// 	console.log(poptotalHash);

console.log("hello2");
var poptotalHash={};
(async function(){
	// const data = await d3.csv("./pop_data20181024_23.csv");
	const data = await d3.csv("./pop_dataWednesday.csv");
	console.log(data);
	//total population variable
	//2018/10/24 23時だけ
	console.log("hello3");
	console.log(data.length);
	console.log(data.time); // undefined
	console.log(data[0]);
	var poptotalHashElementCounter = 0;
	for(var i = 0; i < data.length; i++) {
		if(data[i].time==10){
			poptotalHash[data[i].code]=data[i].pop_total;
			poptotalHashElementCounter += 1;
		}
	}
	console.log("hello4");
	console.log(poptotalHashElementCounter);
	console.log(poptotalHash);

	var switchcodeHash={};
	SubCode.Data.forEach(function(d)
	{	//H_SDNG for map H_DNG for pop
		
		switchcodeHash[d.H_SDNG_CD]=d.H_DNG_CD;
	}
	);


	d3.json("./lib/seoul_submunicipalities_topo_simple.topojson").then(function(data){
		
		var seoul=topojson.feature(data,data.objects.seoul_submunicipalities_geo);
		
		var projection = d3.geoMercator().center([126.9895, 37.5551]).translate([width/2,height/2]).scale(70000);
		
		var path = d3.geoPath().projection(projection);	
		
		svg.selectAll("path").data(seoul.features).enter().append("path").attr("d",path).attr("fill",function(d){
		return "rgb(255,"+Math.floor(color(poptotalHash[switchcodeHash[d.properties.code]]))+","+Math.floor(color(poptotalHash[switchcodeHash[d.properties.code]]))+")";
	}
	).attr("stroke","#333333").attr("stroke-width",0.5);
		
		console.log("hello7");

	});
})();

// var switchcodeHash={};
// SubCode.Data.forEach(function(d)
// {	//H_SDNG for map H_DNG for pop
	
// 	switchcodeHash[d.H_SDNG_CD]=d.H_DNG_CD;
// }
// );


// d3.json("./lib/seoul_submunicipalities_topo_simple.topojson").then(function(data){
	
// 	var seoul=topojson.feature(data,data.objects.seoul_submunicipalities_geo);
	
// 	var projection = d3.geoMercator().center([126.9895, 37.5551]).translate([width/2,height/2]).scale(70000);
	
// 	var path = d3.geoPath().projection(projection);	
	
// 	svg.selectAll("path").data(seoul.features).enter().append("path").attr("d",path).attr("fill",function(d){
// 	return "rgb(255,"+Math.floor(color(poptotalHash[switchcodeHash[d.properties.code]]))+","+Math.floor(color(poptotalHash[switchcodeHash[d.properties.code]]))+")";
// }
// ).attr("stroke","#333333").attr("stroke-width",0.5);
	
// 	console.log("hello7");

// });
</script>
</body>

</html>

