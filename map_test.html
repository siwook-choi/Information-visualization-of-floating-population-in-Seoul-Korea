<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <script src="./lib/d3.js" charset="utf-8"></script>
    <script src="./lib/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?clientId=Fj9YAAdNpZn3oybty5ZB&submodules=geocoder"></script>
    <style>
        .wrapper{
			  display: grid;
			  grid-template-columns: 600px 200px;
			  grid-template-rows: 500px 500px;
		  }
    </style>
</head>

<body>
    <div class="wrapper">
        <div id="div1"></div>
        <div id="div2"></div>
        <div id="div3"></div>
        <div id="div4"></div>
    </div>

    <script type="text/javascript">
        var mapDiv = document.getElementById("div1");
        var map = new naver.maps.Map(mapDiv, {
            zoom: 6
        });

        var tooltip = $('<div style="position:absolute;z-index:1000;padding:5px 10px;background-color:#fff;border:solid 2px #000;font-size:14px;pointer-events:none;display:none;"></div>');
        tooltip.appendTo(map.getPanes().floatPane);

        init();
        var regionGeoJson = [];
        async function init() {
            var seoul_geojson = await d3.json("./lib/seoul_submunicipalities_topo_simple.geojson");
            for (geojson of seoul_geojson.features) {
                regionGeoJson.push(geojson);
            }
            startDataLayer();
        }

        function startDataLayer() {
            map.data.setStyle(function (feature) {
                var styleOptions = {
                    fillColor: '#ff0000',
                    fillOpacity: 0.0001,
                    strokeColor: '#ff0000',
                    strokeWeight: 2,
                    strokeOpacity: 0.4
                };

                if (feature.getProperty('focus')) {
                    styleOptions.fillOpacity = 0.6;
                    styleOptions.fillColor = '#0f0';
                    styleOptions.strokeColor = '#0f0';
                    styleOptions.strokeWeight = 4;
                    styleOptions.strokeOpacity = 1;
                }

                return styleOptions;
            });

            regionGeoJson.forEach(function (geojson) {
                map.data.addGeoJson(geojson);
            });

            map.data.addListener('click', function (e) {
                var feature = e.feature;

                if (feature.getProperty('focus') !== true) {
                    feature.setProperty('focus', true);
                } else {
                    feature.setProperty('focus', false);
                }
            });

            map.data.addListener('mouseover', function (e) {
                var feature = e.feature,
                    regionName = feature.property_name_eng;
                console.log(feature);
                tooltip.css({
                    display: '',
                    left: e.offset.x,
                    top: e.offset.y
                }).text(regionName);

                map.data.overrideStyle(feature, {
                    fillOpacity: 0.6,
                    strokeWeight: 4,
                    strokeOpacity: 1
                });
            });

            map.data.addListener('mouseout', function (e) {
                tooltip.hide().empty();
                map.data.revertStyle();
            });
        }
    </script>
</body>